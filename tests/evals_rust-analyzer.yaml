skill: rust-analyzer
version: 1.0.0
scenarios:
  - name: ownership-violation-detection
    description: "Detect use-after-move error in ownership chain"
    input:
      code_path: "test_data/ownership_bug.rs"
      analysis_focus: "safety"
      rust_edition: "2021"
    expected_output:
      safety_report:
        ownership_issues:
          - category: "move-after-use"
            severity: "critical"
      overall_score: "<70"

  - name: tokio-mutex-held-across-await
    description: "Identify async Mutex held across .await causing contention"
    input:
      code_path: "test_data/async_lock.rs"
      analysis_focus: "concurrency"
      rust_edition: "2021"
    expected_output:
      concurrency_analysis:
        async_issues:
          - message: "Mutex held across .await"
            severity: "high"

  - name: unnecessary-allocations
    description: "Find heap allocations replaceable with stack/slices"
    input:
      code_path: "test_data/hot_path.rs"
      analysis_focus: "performance"
      rust_edition: "2021"
    expected_output:
      performance_recommendations:
        allocations:
          - impact: "high"
            fix: "Use &[u8] instead of Vec<u8>"

  - name: unsafe-soundness-issue
    description: "Detect undefined behavior in unsafe block"
    input:
      code_path: "test_data/unsafe_code.rs"
      analysis_focus: "all"
      rust_edition: "2021"
      check_unsafe: true
    expected_output:
      safety_report:
        unsafe_blocks:
          - soundness_concern: true
            severity: "critical"

  - name: blocking-io-in-async
    description: "Flag std::fs usage in async function"
    input:
      code_path: "test_data/blocking_async.rs"
      analysis_focus: "concurrency"
      rust_edition: "2021"
    expected_output:
      concurrency_analysis:
        async_issues:
          - message: "Blocking I/O in async context"
            fix: "Use tokio::fs"
